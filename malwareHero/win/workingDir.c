#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <dirent.h>
#include <sys/stat.h>
#include <errno.h>

// Function to create a directory
void createDirectory(const char *path) {
    if (mkdir(path, 0777) == 0) {
        printf("Directory created: %s\n", path);
    } else {
        perror("Failed to create directory");
    }
}

// Function to delete a directory and its contents
void deleteDirectory(const char *path) {
    if (rmdir(path) == 0) {
        printf("Directory deleted: %s\n", path);
    } else {
        perror("Failed to delete directory");
    }
}

// Function to list files in a directory
void listFilesInDirectory(const char *path) {
    DIR *dir;
    struct dirent *entry;
    
    dir = opendir(path);
    
    if (dir == NULL) {
        perror("Failed to open directory");
        return;
    }
    
    while ((entry = readdir(dir)) != NULL) {
        if (entry->d_type == DT_REG) {
            printf("File: %s\n", entry->d_name);
        }
    }
    
    closedir(dir);
}

// Function to check if a file exists
int fileExists(const char *path, const char *filename) {
    struct stat buffer;
    char filepath[256];
    snprintf(filepath, sizeof(filepath), "%s/%s", path, filename);
    
    if (stat(filepath, &buffer) == 0) {
        return 1; // File exists
    } else {
        return 0; // File does not exist
    }
}

// Function to read file content
char *readFile(const char *filename) {
    char *content = NULL;
    FILE *file = fopen(filename, "r");
    
    if (file != NULL) {
        fseek(file, 0, SEEK_END);
        long length = ftell(file);
        fseek(file, 0, SEEK_SET);
        
        content = (char *)malloc(length + 1);
        
        if (content != NULL) {
            fread(content, 1, length, file);
            content[length] = '\0';
        }
        
        fclose(file);
    }
    
    return content;
}

// Function to write to a file
void writeFile(const char *filename, const char *data) {
    FILE *file = fopen(filename, "w");
    
    if (file != NULL) {
        fputs(data, file);
        fclose(file);
        printf("Data written to %s\n", filename);
    } else {
        perror("Failed to open file for writing");
    }
}

// Function to copy a file
void copyFile(const char *source, const char *destination) {
    FILE *sourceFile = fopen(source, "rb");
    FILE *destFile = fopen(destination, "wb");
    char ch;
    
    if (sourceFile == NULL || destFile == NULL) {
        perror("Failed to copy file");
        return;
    }
    
    while ((ch = fgetc(sourceFile)) != EOF) {
        fputc(ch, destFile);
    }
    
    fclose(sourceFile);
    fclose(destFile);
    
    printf("File copied from %s to %s\n", source, destination);
}

// Implement the remaining functions for file permissions, file metadata, and file search as needed.

int main() {
    // Example usage of the functions
    const char *path = "/path/to/working_directory"; // Specify the path

    createDirectory("new_directory");
    deleteDirectory("new_directory");
    listFilesInDirectory(path);
    
    if (fileExists(path, "example.txt")) {
        printf("File exists.\n");
    } else {
        printf("File does not exist.\n");
    }
    
    char *fileContent = readFile("example.txt");
    if (fileContent != NULL) {
        printf("File Content:\n%s\n", fileContent);
        free(fileContent);
    }
    
    writeFile("output.txt", "This is a test.");
    copyFile("source.txt", "destination.txt");
    
    return 0;
}
